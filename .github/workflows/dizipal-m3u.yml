name: Dizipal M3U OluÅŸturucu

on:
  schedule:
    - cron: '0 3 * * *'  # Her gÃ¼n TSÄ° 06:00'da Ã§alÄ±ÅŸÄ±r
  workflow_dispatch:      # Manuel Ã§alÄ±ÅŸtÄ±rmaya izin ver

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # DosyayÄ± repo'ya yazmak iÃ§in gerekli izin

    steps:
      - name: Repoyu bilgisayara indir
        uses: actions/checkout@v4

      - name: Python kur
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Gerekli kÃ¼tÃ¼phaneleri yÃ¼kle
        run: pip install cloudscraper requests beautifulsoup4 lxml

      - name: M3U dosyasÄ±nÄ± oluÅŸtur
        run: python scripts/dizipal_m3u_generator.py

      - name: OluÅŸan M3U dosyasÄ±nÄ± depoya kaydet
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git add dizipal.m3u
          # Dosya deÄŸiÅŸtiyse commit ve push yap
          if ! git diff --cached --quiet; then
            git commit -m "ðŸ¤– dizipal.m3u gÃ¼ncellendi - $(date '+%d.%m.%Y %H:%M')"
            git push
          else
            echo "Dosyada deÄŸiÅŸiklik yok, iÅŸlem atlanÄ±yor."
          fi

      - name: M3U dosyasÄ±nÄ± artifact olarak yÃ¼kle (Ä°steÄŸe BaÄŸlÄ±)
        uses: actions/upload-artifact@v4  # DÃœZELTÄ°LDÄ°: v3 -> v4
        with:
          name: dizipal-playlist
          path: dizipal.m3u
